Docker:
sudo service docker start

// Remove all docker containers 
docker rm --force `docker ps -qa`
docker commit `docker ps -qa` ubuntu-consul
rm -rf /tmp/consul/*

Multiple ubuntu dockers with consul SD
// 1. Run ubuntu in docker
docker rm --force `docker ps -qa`

docker run --name first -h first -i -t ubuntu-consul /bin/bash
docker run --name second -h second -i -t ubuntu-consul /bin/bash
docker run --name third -h third -i -t ubuntu-consul /bin/bash

sudo apt-get install wget
sudo apt-get install unzip

// 2. Execute
cd /usr/local/bin
wget https://releases.hashicorp.com/consul/0.6.3/consul_0.6.3_linux_amd64.zip
unzip *.zip
rm *.zip'

// 3. Save this docker as reusable image
(from another terminal)
docker commit `docker ps -qa` ubuntu-consul

// 4. Start consul
(if first one)
consul agent -server -node=first -bootstrap -data-dir /tmp/consul
(else)
consul agent -server -node=second -data-dir /tmp/consul
consul agent -server -node=third -data-dir /tmp/consul

// 5. Join servers
(Check ip address in 'Node at $IP' for servers other than the first one)
consul join $IP1 $IP2 (...)

// 6. Restart first server as normal one (without bootstrap privileges)
CTRL+C
consul agent -server -data-dir /tmp/consul
(in another terminal)
consul join $IP1 (ip of second or third server)

// 7. (Optional) Start web UI to check servers inside browser
consul agent -node=web-ui -data-dir /tmp/consul -ui -join $IP_OF_ONE_SERVER


SHORT:
docker run --name first -h first -i -t ubuntu-consul /bin/bash
consul agent -server -node=first -bootstrap -data-dir /tmp/consul
docker run --name second -h second -i -t ubuntu-consul /bin/bash
consul agent -server -node=second -data-dir /tmp/consul
docker run --name third -h third -i -t ubuntu-consul /bin/bash
consul agent -server -node=third -data-dir /tmp/consul
docker exec first consul join 172.17.0.3 172.17.0.4
consul agent -node=web-ui -data-dir /tmp/consul -ui -join 172.17.0.2



Consul:
// Download consul
(Download consul from https://www.consul.io/downloads.html and extract)
(Move to folder where you extracted it)
sudo mv consul /usr/local/bin/
docker pull progrium/consul


// Run consul on single host
docker run -d --name node1 -h node1 progrium/consul -server -ui-dir /ui -bootstrap
JOIN_IP="$(docker inspect -f '{{.NetworkSettings.IPAddress}}' node1)"
docker run -d --name node2 -h node2 progrium/consul -server -join $JOIN_IP
docker run -d --name node3 -h node3 progrium/consul -server -join $JOIN_IP

docker run -d -p 8400:8400 -p 8500:8500 -p 8600:53/udp --name node4 -h node4 progrium/consul -ui-dir /ui -join $JOIN_IP

// Run consul on multiple terminals
consul agent -server -bootstrap -data-dir /tmp/consul


// Tutorial 
sudo mkdir /var/consul
sudo chmod 755 /var/consul

gksudo gedit /etc/init/consul.conf

(copy text)
	description "Consul server process"

	start on runlevel [2345]
	stop on runlevel [!2345]

	respawn

	script
	  if [ -f "/etc/service/consul" ]; then
	    . /etc/service/consul
	  fi

	export GOMAXPROCS=`nproc`

	exec /usr/local/bin/consul agent \
	  -config-dir="/etc/consul.d/server" \
	  ${CONSUL_FLAGS} \
	  >>/var/log/consul.log 2>&1
	end script
(end this text)

sudo mkdir /etc/consul.d
sudo mkdir /etc/consul.d/server
gksudo gedit /etc/consul.d/server/config.json

(copy text)
	{
		"bootstrap_expect": 3,
		"server": true,
		"data_dir": "/var/consul",
		"log_level": "INFO",
		"enable_syslog": false,
		"retry_join": ["192.168.1.101", "192.168.1.102", "192.168.1.103"],
		"client_addr": "0.0.0.0"
	}
(end copy text)

